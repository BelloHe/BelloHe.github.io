<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  
  <title><![CDATA[Hyjal's blog]]></title>
  <subtitle><![CDATA[on the way]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://hyjal-binbin.com//"/>
  <updated>2018-09-29T11:33:28.694Z</updated>
  <id>http://hyjal-binbin.com//</id>
  
  <author>
    <name><![CDATA[Hyjal]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[机器学习解决信息安全问题之ADFA-LD]]></title>
    <link href="http://hyjal-binbin.com/2018/09/29/ADFA-LD/"/>
    <id>http://hyjal-binbin.com/2018/09/29/ADFA-LD/</id>
    <published>2018-09-29T11:30:25.000Z</published>
    <updated>2018-09-29T11:33:28.694Z</updated>
    <content type="html"><![CDATA[<h1 id="0x00_前言">0x00 前言</h1><p>　　本文记录基于兜哥《Web安全之深度学习实战》、论文《A Semantic Approach to Host-Based Intrusion Detection Systems Using Contiguous and Discontiguous System Call Patterns》和数据集ADFA-LD，利用机器学习解决信息安全问题。<br><a id="more"></a></p>
<h1 id="0x01_数据集介绍">0x01 数据集介绍</h1><p>　　“The ADFA Intrusion Detection Datasets”为澳大利亚国防学院用于测试HIDS生成的数据集，<a href="https://www.unsw.adfa.edu.au/unsw-canberra-cyber/cybersecurity/ADFA-IDS-Datasets/" target="_blank" rel="external">++数据集介绍、相关论文及下载地址++</a>。ADFA数据及分为基于linux操作系统的The ADFA Linux Dataset(ADFA-LD)和和基于windows操作系统的The ADFA Windows Dataset(ADFA-WD)。本文中使用的数据集为ADFA-LD，采集系统配置如下表。1</p>
<table>
<thead>
<tr>
<th>系统</th>
<th>版本</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ubuntu Linux</td>
<td>11.04</td>
</tr>
<tr>
<td>Apache</td>
<td>2.2.17</td>
</tr>
<tr>
<td>PHP</td>
<td>5.3.5</td>
</tr>
<tr>
<td>TikiWiki</td>
<td>8.1</td>
</tr>
</tbody>
</table>
<p>其中Ubuntu打上了所有的补丁，TikiWiki 8.1版本存在已知远程注入漏洞，这样的配置能够提供一个较为安全但存在漏洞的实验环境(官方数据更新时间为2013年)。ADFA-LD数据集解压后包括三个文件夹，如下表所示。</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
<th>数量</th>
</tr>
</thead>
<tbody>
<tr>
<td>Attack_Data</td>
<td>标记为恶意的数据</td>
<td>833</td>
</tr>
<tr>
<td>Training_Data</td>
<td>标记为正常的数据</td>
<td>60</td>
</tr>
<tr>
<td>Validation_Data</td>
<td>评估模型误报率</td>
<td>4372</td>
</tr>
</tbody>
</table>
<p>　　其中Attack_Data中包含6类攻击，分别为Adduser、Hydra_FTP、Hydra_SSH、Java_Meterpreter、Meterpreter、Web_Shell。在Gideon Creech和Jiankun Hu论文中对攻击数据进行了解释，攻击包含web-based exploitation、simulated social engineering、poisoned executables、emotely triggered vulnerabilities、remote password brute force、system manipulation using the C100 webshell。结合论文中的描述和参考文献1，对6类攻击描述如下表。<br>名称 | 描述<br>—-|—-<br>Adduser | 通过各种姿势添加root权限用户<br>Hydra_FTP | Hydra暴力破解FTP<br>Hydra_SSH | Hydra暴力破解SSH<br>Java_Meterpreter | metasploit - java meterpreter<br>Meterpreter | metasploit - meterpreter<br>Web_Shell | C100 webshell</p>
<p>　　数据集已经对捕获的系统调用进行了处理，对每一个捕获的系统调用都使用唯一的数字进行代替，对应关系文件下载地址<a href="https://www.researchgate.net/profile/Obinna_Igbe/post/Were_can_I_get_a_labelled_version_of_the_ADFA-LD_dataset_for_HIDS_evaluation/attachment/59d6283879197b8077986958/AS%3A329293344329728%401455521059484/download/ADFA-LD%2BSyscall%2BList.txt" target="_blank" rel="external">++ADFA-LDSyscallList.txt++</a>。</p>
<h1 id="0x02_机器学习实战">0x02 机器学习实战</h1><p>本文分别提取2-gram, 3-gram, (2-3gram), (1-5gram)作为特征向量,词袋大小为1000</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">from sklearn<span class="selector-class">.feature_extraction</span><span class="selector-class">.text</span> import CountVectorizer</div></pre></td></tr></table></figure>
<p>并使用tf-idf优化</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">from sklearn<span class="selector-class">.feature_extraction</span><span class="selector-class">.text</span> import TfidfTransformer</div></pre></td></tr></table></figure>
<p>选择kaggle比赛神器xgboost和深度学习mlp来进行测试。<br><figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> xgboost <span class="keyword">as</span> xgb</div><div class="line"><span class="title">from</span> sklearn.neural_network <span class="keyword">import</span> MLPClassifier</div></pre></td></tr></table></figure></p>
<p>使用train_test_split将Attack_Data和Training_Data随机取70%作为训练集，30%作为测试集，并将Validation_Data数据输入生成的模型检查误报数。</p>
<p><code>train_test_split(x, y, test_size=0.3)</code></p>
<p>测试结果如下表所示。<br><figure class="highlight capnproto"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> classification_report</div></pre></td></tr></table></figure></p>
<table>
<thead>
<tr>
<th>xgboost</th>
<th>precision</th>
<th>recall</th>
<th>f1-score</th>
<th>误报数(误报率)</th>
</tr>
</thead>
<tbody>
<tr>
<td>2-gram</td>
<td>0.98</td>
<td>0.98</td>
<td>0.98</td>
<td>679(15.53%)</td>
</tr>
<tr>
<td>3-gram</td>
<td>0.99</td>
<td>0.99</td>
<td>0.99</td>
<td>655(14.98%)</td>
</tr>
<tr>
<td>2-3gram</td>
<td>0.99</td>
<td>0.99</td>
<td>0.99</td>
<td>665(15.21%)</td>
</tr>
<tr>
<td>1-5gram</td>
<td>0.87</td>
<td>0.84</td>
<td>0.84</td>
<td>655(14.98%)</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>mlp</th>
<th>precision</th>
<th>recall</th>
<th>f1-score</th>
<th>误报数  </th>
</tr>
</thead>
<tbody>
<tr>
<td>2-gram</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>609(13.93%)</td>
</tr>
<tr>
<td>3-gram</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>684(15.64%)</td>
</tr>
<tr>
<td>2-3gram</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>693(15.85%)</td>
</tr>
<tr>
<td>1-5gram</td>
<td>0.99</td>
<td>0.99</td>
<td>0.99</td>
<td>684(15.65%)</td>
</tr>
</tbody>
</table>
<h1 id="0x03_小结">0x03 小结</h1><ol>
<li>本文并未进行调参，所得结论不一定准确或者一定不准确。</li>
<li>从测试集评分和Validation_Data数据集误报率看，选择2-gram和mlp具有最好的实验效果。</li>
<li>测试集评分mlp高于xgboost，Validation_Data数据集误报率xgboost优于mlp，mlp过拟合现象比xgboost严重。<ol>
<li>由于没有调参，mlp参数设置不合理。</li>
<li>训练样本太少。</li>
<li>xgboost做分类就是强</li>
</ol>
</li>
<li>从误报率看，使用n-gram特征能够取得一定的实验效果，但高误报率依然存在，无法直接用于生产。<h1 id="参考文献">参考文献</h1></li>
<li><a href="https://www.zuozuovera.cn/archives/918/" target="_blank" rel="external">ADFA数据集介绍</a></li>
<li><a href="https://item.jd.com/12277728.html" target="_blank" rel="external">Web安全之深度学习实战</a></li>
</ol>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="0x00_前言">0x00 前言</h1><p>　　本文记录基于兜哥《Web安全之深度学习实战》、论文《A Semantic Approach to Host-Based Intrusion Detection Systems Using Contiguous and Discontiguous System Call Patterns》和数据集ADFA-LD，利用机器学习解决信息安全问题。<br>]]>
    
    </summary>
    
      <category term="机器学习" scheme="http://hyjal-binbin.com/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="深度学习" scheme="http://hyjal-binbin.com/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[涨知识]]></title>
    <link href="http://hyjal-binbin.com/2017/10/12/bigbrother/"/>
    <id>http://hyjal-binbin.com/2017/10/12/bigbrother/</id>
    <published>2017-10-12T11:33:44.000Z</published>
    <updated>2018-03-12T13:42:35.594Z</updated>
    <content type="html"><![CDATA[<p>2018-3-8 更新<br>　　向大佬、大厂学习信息安全。包括安全资讯媒体、技术论坛、博客、微博、公众号、推特</p>
<h1 id="前排大厂干货">前排大厂干货</h1><p>　　<font color="red" size="5">腾讯玄武实验室</font><br>微信公众号：XuanwuLab，博客：<a href="http://xlab.tencent.com" target="_blank" rel="external"><font color="blue">xlab.tencent.com</font></a><br>　　<font color="red" size="5">360网络安全研究院</font><br>微信公众号：NetLab_360，博客：<a href="http://netlab.360.com" target="_blank" rel="external"><font color="blue">netlab.360.com</font></a></p>
<h1 id="0x00_公共资源">0x00 公共资源</h1><h2 id="安全资讯">安全资讯</h2><p>　　<a href="http://www.freebuf.com" target="_blank" rel="external"><font color="blue" size="5">FreeBuf</font></a>    黑客与极客,国内关注度最高的全球互联网安全媒体平台,同时也是爱好者们交流与分享安全技术的最佳社区。<br>　　<a href="http://bobao.360.cn" target="_blank" rel="external"><font color="blue" size="5">安全客</font></a>    为广大安全爱好者和安全从业人员提供权威信息发布的漏洞信息,最新的安全资讯,最全的安全知识和精彩的安全活动直播。<br>　　<a href="http://bobao.360.cn" target="_blank" rel="external"><font color="blue" size="5">SeccWiki</font></a>    致力于提供最新、最专业的安全资讯分享平台,方便安全人员获取安全事件、精品技术文章、技术专题。</p>
<h2 id="技术论坛">技术论坛</h2><p>　　<a href="https://bbs.pediy.com" target="_blank" rel="external"><font color="blue" size="5">看雪论坛</font></a>    致力于PC、移动、智能设备安全研究及逆向工程的开发者社区。<br>　　<a href="https://www.52pojie.cn" target="_blank" rel="external"><font color="blue" size="5">吾爱破解</font></a>    论坛致力于软件安全与病毒分析的前沿,丰富的技术版块交相辉映,由无数热衷于软件加密解密及反病毒爱好者共同维护<br>　　<a href="https://bbs.kafan.cn" target="_blank" rel="external"><font color="blue" size="5">卡饭论坛</font></a>    杀软测评，样本下载<br><a id="more"></a></p>
<h1 id="0x01_巨人的肩膀">0x01 巨人的肩膀</h1><h2 id="说明">说明</h2><p>　　[<font color="green">绿色</font>]：活跃<br>　　[<font color="gray">灰色</font>]：几乎不再更新<br>　　[<font color="red">红色</font>]：炫富类</p>
<h2 id="博客">博客</h2><p>　　<a href="https://www.leavesongs.com" target="_blank" rel="external"><font color="green" size="5">离别歌</font></a><br>　　<a href="http://taosay.net/" target="_blank" rel="external"><font color="gray" size="5">道哥的黑板报</font></a><br>　　<a href="http://www.ms509.com" target="_blank" rel="external"><font color="green" size="5">MS509 Team</font></a><br>　　<a href="https://whereisk0shl.top" target="_blank" rel="external"><font color="green" size="5">k0shl</font></a><br>　　<a href="https://0x557.org" target="_blank" rel="external"><font color="gray" size="5">0x557(猪猪侠)</font></a><br>　　<a href="http://mxny.org" target="_blank" rel="external"><font color="gray" size="5">麦香</font></a><br>　　<a href="http://balis0ng.com/" target="_blank" rel="external"><font color="green" size="5">Balis0ng</font></a></p>
<h2 id="微博">微博</h2><p>　　<a href="http://weibo.com/zhengmin1989" target="_blank" rel="external"><font color="green" size="5">蒸米spark</font></a>    阿里越狱大佬<br>　　<a href="http://weibo.com/evilcos" target="_blank" rel="external"><font color="green" size="5">余弦</font></a>    知道创宇<br>　　<a href="http://weibo.com/sunwe4r" target="_blank" rel="external"><font color="red" size="5">sunwear</font></a>    邪恶八进制<br>　　<a href="http://weibo.com/pstyunshu" target="_blank" rel="external"><font color="red" size="5">安全_云舒</font></a>    默安科技联合创始人兼CTO，资深网络安全研究人员<br>　　<a href="https://weibo.com/k0pwn" target="_blank" rel="external"><font color="green" size="5">我叫0day谁找我_</font></a>    漏洞大佬<br>　　<a href="https://weibo.com/babyboaes" target="_blank" rel="external"><font color="green" size="5">老实敦厚的大宝</font></a>    漏洞大佬2<br>　　<a href="https://weibo.com/ir0nsmith" target="_blank" rel="external"><font color="green" size="5">杨卿-Ir0nSmith</font></a>    360 IOT安全研究院 副院长<br>　　<a href="https://weibo.com/ringzero" target="_blank" rel="external"><font color="green" size="5">ringzero</font></a>    猪猪侠</p>
<h2 id="公众号">公众号</h2><p>　　<font color="green" size="5">腾讯玄武实验室</font><br>　　<font color="green" size="5">360威胁情报中心</font><br>　　<font color="green" size="5">SAINTSEC</font><br>　　<font color="green" size="5">360网络安全研究院</font></p>
<h2 id="推特">推特</h2><p>　　包含活跃在推特的国内大佬们（mj0011，蒸米Spark，古河，TK教主）<br>　　<a href="https://twitter.com/Dinosn" target="_blank" rel="external"><font color="green" size="5">Nicolas Krassas</font></a>     EK、PoC、RAT、Rootkit<br>　　<a href="https://twitter.com/JaromirHorejsi" target="_blank" rel="external"><font color="green" size="5">JaromirHorejsi</font></a>     样本大佬；恶意程序下载地址<br>　　<a href="https://twitter.com/JohnLaTwC" target="_blank" rel="external"><font color="green" size="5">John Lambert</font></a>     微软威胁情报中心大佬<br>　　<a href="https://twitter.com/subTee" target="_blank" rel="external"><font color="green" size="5">Casey Smith</font></a><br>　　<a href="https://twitter.com/mattifestation" target="_blank" rel="external"><font color="green" size="5">Matt Graeber</font></a><br>　　<a href="https://twitter.com/mj0011sec" target="_blank" rel="external"><font color="green" size="5">mj0011</font></a><br>　　<a href="https://twitter.com/guhe120" target="_blank" rel="external"><font color="green" size="5">Yuki Chen(古河)</font></a><br>　　<a href="https://twitter.com/SparkZheng" target="_blank" rel="external"><font color="green" size="5">Min(Spark) Zheng</font></a><br>　　<a href="https://twitter.com/tombkeeper" target="_blank" rel="external"><font color="green" size="5">tombkeeper</font></a>    </p>
]]></content>
    <summary type="html">
    <![CDATA[<p>2018-3-8 更新<br>　　向大佬、大厂学习信息安全。包括安全资讯媒体、技术论坛、博客、微博、公众号、推特</p>
<h1 id="前排大厂干货">前排大厂干货</h1><p>　　<font color="red" size="5">腾讯玄武实验室</font><br>微信公众号：XuanwuLab，博客：<a href="http://xlab.tencent.com" target="_blank" rel="external"><font color="blue">xlab.tencent.com</font></a><br>　　<font color="red" size="5">360网络安全研究院</font><br>微信公众号：NetLab_360，博客：<a href="http://netlab.360.com" target="_blank" rel="external"><font color="blue">netlab.360.com</font></a></p>
<h1 id="0x00_公共资源">0x00 公共资源</h1><h2 id="安全资讯">安全资讯</h2><p>　　<a href="http://www.freebuf.com" target="_blank" rel="external"><font color="blue" size="5">FreeBuf</font></a>    黑客与极客,国内关注度最高的全球互联网安全媒体平台,同时也是爱好者们交流与分享安全技术的最佳社区。<br>　　<a href="http://bobao.360.cn" target="_blank" rel="external"><font color="blue" size="5">安全客</font></a>    为广大安全爱好者和安全从业人员提供权威信息发布的漏洞信息,最新的安全资讯,最全的安全知识和精彩的安全活动直播。<br>　　<a href="http://bobao.360.cn" target="_blank" rel="external"><font color="blue" size="5">SeccWiki</font></a>    致力于提供最新、最专业的安全资讯分享平台,方便安全人员获取安全事件、精品技术文章、技术专题。</p>
<h2 id="技术论坛">技术论坛</h2><p>　　<a href="https://bbs.pediy.com" target="_blank" rel="external"><font color="blue" size="5">看雪论坛</font></a>    致力于PC、移动、智能设备安全研究及逆向工程的开发者社区。<br>　　<a href="https://www.52pojie.cn" target="_blank" rel="external"><font color="blue" size="5">吾爱破解</font></a>    论坛致力于软件安全与病毒分析的前沿,丰富的技术版块交相辉映,由无数热衷于软件加密解密及反病毒爱好者共同维护<br>　　<a href="https://bbs.kafan.cn" target="_blank" rel="external"><font color="blue" size="5">卡饭论坛</font></a>    杀软测评，样本下载<br>]]>
    
    </summary>
    
      <category term="信息安全学习资料" scheme="http://hyjal-binbin.com/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[SinaL2行情接口C#]]></title>
    <link href="http://hyjal-binbin.com/2017/02/07/SinaL2/"/>
    <id>http://hyjal-binbin.com/2017/02/07/SinaL2/</id>
    <published>2017-02-06T16:00:00.000Z</published>
    <updated>2018-03-12T13:39:30.598Z</updated>
    <content type="html"><![CDATA[<h1 id="0x00_说明">0x00 说明</h1><p>　　改自开源项目<a href="https://github.com/Emptyset110/SinaL2" target="_blank" rel="external"><font color="blue">dHydra</font></a>，因需求原因只提取其中行情订阅的部分。由于需要订阅全部股票，所以改为C#版本以提升性能。</p>
<h1 id="0x01_新浪登录">0x01 新浪登录</h1><p>　　新浪不在提供L2，所以(太懒)没内容了，抱歉。</p>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="0x00_说明">0x00 说明</h1><p>　　改自开源项目<a href="https://github.com/Emptyset110/SinaL2" target="_blank" rel="external"><font color="blue">dH]]>
    </summary>
    
      <category term="python" scheme="http://hyjal-binbin.com/categories/python/"/>
    
      <category term="C#" scheme="http://hyjal-binbin.com/categories/python/C/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[做一个对妹纸有用的程序员]]></title>
    <link href="http://hyjal-binbin.com/2016/08/08/ShowMeTheGirl/"/>
    <id>http://hyjal-binbin.com/2016/08/08/ShowMeTheGirl/</id>
    <published>2016-08-08T12:27:25.000Z</published>
    <updated>2016-08-08T14:22:36.441Z</updated>
    <content type="html"><![CDATA[<h1 id="0x00_背景">0x00 背景</h1><p>　　接到妹纸电话，问我会不会使用按键精灵，帮她到一个网站上刷题。<br>　　<font color="red" size="12">我会！！！</font><br>　　妹纸提供的方案是用按键精灵实现每个题都选C，然后提交，但在实际使用过程中出现了以下问题：<br>　　(1)有些题并没有C选项<br>　　(2)选择答案按钮，提交按钮和下一题按钮的位置随题干和解析的长度变换，位置不固定<br>　　(3)该做题系统应该是部署在内网的，妹纸给的外网地址访问奇慢无比，经常掉线<br>　　由于以上原因，我认为无法通过按键精灵的方法达到500分(回答正确一题得0.2分)，所有决定采取其他的方法。<br><a id="more"></a></p>
<h1 id="0x01_发现漏洞">0x01 发现漏洞</h1><p>　　首先想到的是在点击提交按钮时抓包，是否能够直接暴力遍历提交。利用Burpsuite抓包，发现了一个惊人的事实，在我拦截了提交答案的post包的情况下，网页依然对我提交的答案进行了判断，而放行post包后的返回包中只包含题目解析，没有答题是否正确的信息。由此判断题目答案已经保存在网页中，不需要再与服务器进行交互。按F12，果然找到了所有题目的答案，如下图：</p>
<p><div align="center"><br><img src="/img/answer.png" alt="answer" align="center"><br></div><br>　　再观察提交按钮的post包，如下图：</p>
<p><div align="center"><br><img src="/img/post.png" alt="post" align="center"><br></div><br>　　根据post包的payload信息，只要找到了答案tmAnswer与treeId、treeRoad、tmId的对应关系，就能提供正确答案遍历试题。全程抓包，在点击开始做题时，向服务器请求题目(GetPracticeList)在返回包中包含了tmAnswer、treeId、treeRoad、tmId，post包和返回包如下图所示，根据返回结果，pageSize参数为请求的题目数量，默认为50题，返回包中的TotalCount为剩余的最大题目数。</p>
<p><div align="center"><br><img src="/img/GetPracticeList.png" alt="GetPracticeList" align="center"><br></div></p>
<p><div align="center"><br><img src="/img/GetPracticeListRe.png" alt="GetPracticeListRe" align="center"><br></div></p>
<h1 id="0x02_利用漏洞刷题">0x02 利用漏洞刷题</h1><p>　　在获取上述信息之后，就可以利用Burpsuite的Intruder功能刷分了。首先在点击按时做题时抓包，修改pageSize参数为上个返回包中的最大题目数，截取返回包，提取json(其中包含了tmAnswer、treeId、treeRoad、tmId信息)，将其保存到txt文件中。利用python解析json，提取tmAnswer、treeId、treeRoad、tmId信息，分别保存在tmAnswer.txt、treeId.txt、treeRoad.txt、tmId.txt中，代码如下：<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">with</span> <span class="built_in">open</span>(filename) <span class="keyword">as</span> f:</div><div class="line">    data = json.<span class="built_in">load</span>(f)</div><div class="line">    print <span class="built_in">len</span>(data)</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="built_in">len</span>(data)):</div><div class="line">        tmAnswer.append(data[i][<span class="string">'TmAnswer'</span>])</div><div class="line">        treeId.append(data[i][<span class="string">'TreeId'</span>])</div><div class="line">        treeRoad.append(data[i][<span class="string">'TreeRoad'</span>])</div><div class="line">        tmId.append(data[i][<span class="string">'RegID'</span>])</div><div class="line"></div><div class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">"tmAnswer.txt"</span>, <span class="string">'w'</span>) <span class="keyword">as</span> ftmAnswer:</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="built_in">len</span>(data)):</div><div class="line">                ftmAnswer.<span class="built_in">write</span>(tmAnswer[i] + <span class="string">'\n'</span>)</div><div class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">"treeId.txt"</span>, <span class="string">'w'</span>) <span class="keyword">as</span> ftreeId:</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="built_in">len</span>(data)):</div><div class="line">            ftreeId.<span class="built_in">write</span>(str(treeId[i]) + <span class="string">'\n'</span>)</div><div class="line"></div><div class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">"treeRoad.txt"</span>, <span class="string">'w'</span>) <span class="keyword">as</span> ftreeRoad:</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="built_in">len</span>(data)):</div><div class="line">            ftreeRoad.<span class="built_in">write</span>(str(treeRoad[i]).<span class="built_in">replace</span>(<span class="string">","</span>, <span class="string">"%2C"</span>) + <span class="string">'\n'</span>)</div><div class="line"></div><div class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">"tmId.txt"</span>, <span class="string">'w'</span>) <span class="keyword">as</span> ftmId:</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="built_in">len</span>(data)):</div><div class="line">            ftmId.<span class="built_in">write</span>(str(tmId[i]) + <span class="string">'\n'</span>)</div></pre></td></tr></table></figure></p>
<p>　　在测试过程中，发现返回的json中的TmAnswer有个别出现了格式错误，加入error存储错误的下标，将错误的情况剔除。修改后的代码如下：<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">def dealJson(filename):</div><div class="line">    with <span class="keyword">open</span>(filename) <span class="keyword">as</span> f:</div><div class="line">        <span class="keyword">data</span> = json.load(f)</div><div class="line">    print len(<span class="keyword">data</span>)</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(<span class="keyword">data</span>)):</div><div class="line">        tmAnswer.append(<span class="keyword">data</span>[i][<span class="string">'TmAnswer'</span>])</div><div class="line">        treeId.append(<span class="keyword">data</span>[i][<span class="string">'TreeId'</span>])</div><div class="line">        treeRoad.append(<span class="keyword">data</span>[i][<span class="string">'TreeRoad'</span>])</div><div class="line">        tmId.append(<span class="keyword">data</span>[i][<span class="string">'RegID'</span>])</div><div class="line"></div><div class="line">    with <span class="keyword">open</span>(<span class="string">"tmAnswer.txt"</span>, <span class="string">'w'</span>) <span class="keyword">as</span> ftmAnswer:</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(<span class="keyword">data</span>)):</div><div class="line">            <span class="keyword">try</span>:</div><div class="line">                ftmAnswer.write(tmAnswer[i] + <span class="string">'\n'</span>)</div><div class="line">            except:</div><div class="line">                error.append(i)</div><div class="line"></div><div class="line">    with <span class="keyword">open</span>(<span class="string">"treeId.txt"</span>, <span class="string">'w'</span>) <span class="keyword">as</span> ftreeId:</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(<span class="keyword">data</span>)):</div><div class="line">            <span class="keyword">if</span> i <span class="keyword">in</span> error:</div><div class="line">                <span class="keyword">continue</span></div><div class="line">            ftreeId.write(str(treeId[i]) + <span class="string">'\n'</span>)</div><div class="line"></div><div class="line">    with <span class="keyword">open</span>(<span class="string">"treeRoad.txt"</span>, <span class="string">'w'</span>) <span class="keyword">as</span> ftreeRoad:</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(<span class="keyword">data</span>)):</div><div class="line">            <span class="keyword">if</span> i <span class="keyword">in</span> error:</div><div class="line">                <span class="keyword">continue</span></div><div class="line">            ftreeRoad.write(str(treeRoad[i]).replace(<span class="string">","</span>, <span class="string">"%2C"</span>) + <span class="string">'\n'</span>)</div><div class="line"></div><div class="line">    with <span class="keyword">open</span>(<span class="string">"tmId.txt"</span>, <span class="string">'w'</span>) <span class="keyword">as</span> ftmId:</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(<span class="keyword">data</span>)):</div><div class="line">            <span class="keyword">if</span> i <span class="keyword">in</span> error:</div><div class="line">                <span class="keyword">continue</span></div><div class="line">            ftmId.write(str(tmId[i]) + <span class="string">'\n'</span>)</div></pre></td></tr></table></figure></p>
<p>　　利用Burpsuite中的Intruder功能，选择Pitchfork模式，载入tmAnswer.txt、treeId.txt、treeRoad.txt、tmId.txt，实现遍历答题。</p>
<p><div align="center"><br><img src="/img/Pitchfork.png" alt="Pitchfork" align="center"><br></div></p>
<p><div align="center"><br><img src="/img/PitchforkRet.png" alt="PitchforkRet" align="center"><br></div></p>
<h1 id="0x03">0x03</h1><p>　　<font color="red" size="12">妹纸说分不要弄太高，不要太高调！！！</font></p>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="0x00_背景">0x00 背景</h1><p>　　接到妹纸电话，问我会不会使用按键精灵，帮她到一个网站上刷题。<br>　　<font color="red" size="12">我会！！！</font><br>　　妹纸提供的方案是用按键精灵实现每个题都选C，然后提交，但在实际使用过程中出现了以下问题：<br>　　(1)有些题并没有C选项<br>　　(2)选择答案按钮，提交按钮和下一题按钮的位置随题干和解析的长度变换，位置不固定<br>　　(3)该做题系统应该是部署在内网的，妹纸给的外网地址访问奇慢无比，经常掉线<br>　　由于以上原因，我认为无法通过按键精灵的方法达到500分(回答正确一题得0.2分)，所有决定采取其他的方法。<br>]]>
    
    </summary>
    
      <category term="python" scheme="http://hyjal-binbin.com/tags/python/"/>
    
      <category term="Burp Suite" scheme="http://hyjal-binbin.com/tags/Burp-Suite/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Python编码转换]]></title>
    <link href="http://hyjal-binbin.com/2016/03/24/decode/"/>
    <id>http://hyjal-binbin.com/2016/03/24/decode/</id>
    <published>2016-03-24T12:27:25.000Z</published>
    <updated>2016-09-23T02:52:01.935Z</updated>
    <content type="html"><![CDATA[<h1 id="0x00_概要">0x00 概要</h1><p>　　记录通过从linux传输文件到windows的辛酸历程。</p>
<h1 id="0x01_向ascii说不">0x01 向ascii说不</h1><p>　　ASCII码一共规定了128个字符的编码，比如空格”SPACE”是32（二进制00100000），大写的字母A是65（二进制01000001）。这128个符号（包括32个不能打印出来的控制符号），只占用了一个字节的后面7位，最前面的1位统一规定为0。128个字符对于英文来说足够了，但对于中文来说是远远不够的。当接收文件名中包含中文的文件时，在创建文件的过程中易出现<font color="red">IOError: [Errno 22] invalid mode (‘r’) or filename</font>这样的错误。python 2.7 默认编码为ascii。<a id="more"></a>可以通过如图所示方式查看python默认编码</p>
<p><div align="center"><br><img src="/img/defaultencoding.png" alt="defaultencoding" align="center"><br></div><br>　　利用python从linux传输文件到windows第一步要做的就是设置默认编码为utf-8<br><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> sys</div><div class="line"><span class="keyword">default</span><span class="number">_</span>encoding = <span class="string">'utf-8'</span></div><div class="line"><span class="keyword">if</span> sys.getdefaultencoding() != <span class="keyword">default</span><span class="number">_</span>encoding:</div><div class="line">    reload(sys)</div><div class="line">    sys.setdefaultencoding(<span class="keyword">default</span><span class="number">_</span>encoding)</div></pre></td></tr></table></figure></p>
<h1 id="0x02_判断编码，进行编码转换">0x02 判断编码，进行编码转换</h1><p>　　判断编码推荐用chardet。chardet将给出为某种编码的可能性，代码如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> chardet</div><div class="line"><span class="built_in">print</span> chardet.detect(<span class="type">XXX</span>)</div></pre></td></tr></table></figure></p>
<p>　　判断出编码类型后，对编码进行转换。<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#假设判断为utf8编码</span></div><div class="line"><span class="attr">strtmp</span> = strXXX.decode(<span class="string">'UTF-8'</span>)</div><div class="line"><span class="attr">strXXX</span> = strtmp.encode(<span class="string">'GBK'</span>)</div></pre></td></tr></table></figure></p>
<h1 id="0x03_decode/encode失败处理">0x03 decode/encode失败处理</h1><p>　　在程序使用过程中，出现了decode/encode错误的情况，网上搜索后判断应该是字符串中存在半/全角符号无法被识别的情况。强行解决方案如下：<br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span>:</div><div class="line">　　strtmp = strXXX.decode(<span class="string">'UTF-8'</span>)</div><div class="line"><span class="keyword">except</span>:</div><div class="line">　　strtmp = strXXX.decode(<span class="string">'UTF-8'</span>,<span class="string">'ignore'</span>)</div><div class="line"><span class="keyword">try</span>:</div><div class="line">　　strXXX = strtmp.encode(<span class="string">'GBK'</span>)</div><div class="line"><span class="keyword">except</span>:</div><div class="line">　　strXXX = strtmp.encode(<span class="string">'GBK'</span>,<span class="string">'ignore'</span>)</div></pre></td></tr></table></figure></p>
<p>　　上面的方法虽然能在一定程度上解决问题，但不可靠，如有建议欢迎留言。</p>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="0x00_概要">0x00 概要</h1><p>　　记录通过从linux传输文件到windows的辛酸历程。</p>
<h1 id="0x01_向ascii说不">0x01 向ascii说不</h1><p>　　ASCII码一共规定了128个字符的编码，比如空格”SPACE”是32（二进制00100000），大写的字母A是65（二进制01000001）。这128个符号（包括32个不能打印出来的控制符号），只占用了一个字节的后面7位，最前面的1位统一规定为0。128个字符对于英文来说足够了，但对于中文来说是远远不够的。当接收文件名中包含中文的文件时，在创建文件的过程中易出现<font color="red">IOError: [Errno 22] invalid mode (‘r’) or filename</font>这样的错误。python 2.7 默认编码为ascii。]]>
    
    </summary>
    
      <category term="python" scheme="http://hyjal-binbin.com/tags/python/"/>
    
      <category term="编码" scheme="http://hyjal-binbin.com/tags/%E7%BC%96%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[pandas库学习笔记]]></title>
    <link href="http://hyjal-binbin.com/2015/12/10/pandas/"/>
    <id>http://hyjal-binbin.com/2015/12/10/pandas/</id>
    <published>2015-12-09T16:00:00.000Z</published>
    <updated>2016-07-12T10:38:09.111Z</updated>
    <content type="html"><![CDATA[<h1 id="0x00_简单说明">0x00 简单说明</h1><p>　　作为机器学习小白，看了一段时间的coursera上Andrew Ng的视频，感觉还是难以入门，所以报名参加阿里天池上的比赛将理论和实践结合来提高姿势。题目是公交线路客流预测，所给的数据中并没有将乘客数量统计出来，需要自己对数据进行统计。先是自己写个python来统计分析数据(大概900M)，但跑了一晚上，发现太慢，在网上搜索到了pandas库，不到半个小时就统计完成。</p>
<h1 id="0x01_数据提取">0x01 数据提取</h1><p>　　pandas.read_csv可按照一定的格式打开txt、csv文件。read_csv可选参数很多，全部参数请看<a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_csv.html?highlight=read_csv#pandas.read_csv" target="_blank" rel="external"><font color="blue">官方文档</font></a>，这里我只记录我觉得有用的和我用到的参数。<a id="more"></a><br><figure class="highlight vala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># filepath_or_buffer    数据文件的路径</span></div><div class="line"><span class="meta"># sep                   数据的分割符号，不填则默认为','。阿里天池和kaggle的数据一般都是用','分割</span></div><div class="line"><span class="meta"># header                每一列的列名，如果数据文件中有列名，则忽略，否则填None</span></div><div class="line"><span class="meta"># names                 当header=None，names填入你要设置的列名</span></div><div class="line">e.g.</div><div class="line">df = pd.read_csv(<span class="string">"gd_train_data.txt"</span>,header=None,names = [<span class="string">'Use_city'</span>,<span class="string">'Line_name'</span>,<span class="string">'Terminal_id'</span>,<span class="string">'Card_id'</span>,<span class="string">'Create_city'</span>,<span class="string">'Deal_time'</span>,<span class="string">'Card_type'</span>])</div></pre></td></tr></table></figure></p>
<h1 id="0x02_数据分析与统计">0x02 数据分析与统计</h1><p>　　当数据比较大时，记事本或者notepad++等程序无法打开，pandas给出了几个函数可以快速进行数据分析与统计。</p>
<h2 id="df-head()"><font color="red">df.head()</font></h2><p>　　查看前5行数据</p>
<h2 id="df-describe()"><font color="red">df.describe()</font></h2><p>　　快速统计数据，可以方便我们观察数据的特性。describe有3个参数percentiles、include、exclude。percentliles可设置数据分层百分比，不填则默认为25%、50%、75%。include设置要统计的数据类型，默认为numeric dtypes，还有object dtypes、mixed dtypes可选。<br><figure class="highlight prolog"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">e.g.</div><div class="line">df.describe(include=[<span class="string">'O'</span>])</div></pre></td></tr></table></figure></p>
<h2 id="df[u’columns_name’]-value_counts()"><font color="red">df[u’columns name’].value_counts()</font></h2><p>　　统计设置的columns有哪些value，对应的value counts，返回的结构中包含index和value数组。index数组存放value，value数组存放value counts。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">e.g.</div><div class="line">Card_type_table = df[<span class="string">u'Card_type'</span>].value_counts() <span class="comment">#统计卡片类型有哪几种，每种类型的卡片有多少张</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(Card_type_table.index)):</div><div class="line">	<span class="keyword">if</span> Card_type_table.index[i] == <span class="string">'卡片种类'</span>:</div><div class="line">		Num_Card_type_XXX == Card_type_table.values[i]</div><div class="line">	<span class="keyword">elif</span> ...</div><div class="line">	...</div></pre></td></tr></table></figure></p>
<h2 id="条件过滤"><font color="red">条件过滤</font></h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">e.g.</div><div class="line">df[df[<span class="string">u'Line_name'</span>]== Line_name)]  <span class="comment">#单个条件</span></div><div class="line">df[(df[<span class="string">u'Line_name'</span>]== Line_name ) &amp; (df[<span class="string">u'Deal_time'</span>] == Deal_time)]  <span class="comment">#多条件过滤用'&amp;'连接，并加上'()'</span></div></pre></td></tr></table></figure>
<h2 id="pd-Series()"><font color="red">pd.Series()</font></h2><p>　　添加列。两个参数，第一个参数为要添加的列数组，第二个参数为index。<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">e</span>.g.</div><div class="line"># 为df添加列<span class="string">'common'</span>,<span class="built_in">add</span>为要添加的列数组：<span class="built_in">add</span> = [<span class="string">''</span>,<span class="string">''</span>,<span class="string">''</span>,...]</div><div class="line">df = pd.read_csv(<span class="string">"gd_train_data.txt"</span>,header=None,names = [<span class="string">'Use_city'</span>,<span class="string">'Line_name'</span>,<span class="string">'Terminal_id'</span>,<span class="string">'Card_id'</span>,<span class="string">'Create_city'</span>,<span class="string">'Deal_time'</span>,<span class="string">'Card_type'</span>])</div><div class="line">df[<span class="string">'common'</span>] = pd.Series(<span class="built_in">add</span>,<span class="built_in">index</span> = df.<span class="built_in">index</span>)</div></pre></td></tr></table></figure></p>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="0x00_简单说明">0x00 简单说明</h1><p>　　作为机器学习小白，看了一段时间的coursera上Andrew Ng的视频，感觉还是难以入门，所以报名参加阿里天池上的比赛将理论和实践结合来提高姿势。题目是公交线路客流预测，所给的数据中并没有将乘客数量统计出来，需要自己对数据进行统计。先是自己写个python来统计分析数据(大概900M)，但跑了一晚上，发现太慢，在网上搜索到了pandas库，不到半个小时就统计完成。</p>
<h1 id="0x01_数据提取">0x01 数据提取</h1><p>　　pandas.read_csv可按照一定的格式打开txt、csv文件。read_csv可选参数很多，全部参数请看<a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_csv.html?highlight=read_csv#pandas.read_csv" target="_blank" rel="external"><font color="blue">官方文档</font></a>，这里我只记录我觉得有用的和我用到的参数。]]>
    
    </summary>
    
      <category term="机器学习" scheme="http://hyjal-binbin.com/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[python urllib2学习]]></title>
    <link href="http://hyjal-binbin.com/2015/10/30/pythonweibo/"/>
    <id>http://hyjal-binbin.com/2015/10/30/pythonweibo/</id>
    <published>2015-10-30T10:05:39.191Z</published>
    <updated>2015-11-02T09:20:53.785Z</updated>
    <content type="html"><![CDATA[<h1 id="0x00_初探">0x00 初探</h1><p>　　提取百度主页html<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#coding=utf8</span></div><div class="line"><span class="keyword">import</span> urllib2</div><div class="line"></div><div class="line"><span class="built_in">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    url = <span class="string">'http://www.baidu.com'</span></div><div class="line">    <span class="built_in">print</span> urllib2.urlopen(url).<span class="built_in">read</span>()</div></pre></td></tr></table></figure></p>
<p><div align="center"><br><img src="/img/baidu.png" alt="baidu" align="center"><br></div></p>
<h1 id="0x01_cookie&amp;timeout">0x01 cookie&amp;timeout</h1><p>　　提取新浪微博“weibo.com/u/1000000002”出错，分析返回的html，请教同学后，猜测可能是没有加入cookie的原因用burpsuite拦截抓包，提取cookie:SUBP=0033W…….。也可用浏览器访问，保存cookie，然后提取。<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">#coding=utf8</div><div class="line">import urllib2</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    url = <span class="string">'http://weibo.com/u/1000000002'</span></div><div class="line">    <span class="built_in">rep</span> = urllib2.Request(url)</div><div class="line">    <span class="built_in">rep</span>.add_header(<span class="string">'cookie'</span>,<span class="string">'你的cookie'</span>)</div><div class="line">    <span class="built_in">print</span> urllib2.urlopen(<span class="built_in">rep</span>).<span class="built_in">read</span>()</div></pre></td></tr></table></figure></p>
<p>　　遍历获取weibo信息时,会出现卡死在urlopen，加入timeout解决此问题<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="builtin-name">print</span> urllib2.urlopen(rep,<span class="attribute">timeout</span>=10).read()</div></pre></td></tr></table></figure></p>
<p>参考资料：<br><a href="http://zhuoqiang.me/python-urllib2-usage.html" target="_blank" rel="external"><font color="blue">Python 标准库 urllib2 的使用细节</font></a></p>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="0x00_初探">0x00 初探</h1><p>　　提取百度主页html<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</di]]>
    </summary>
    
      <category term="python" scheme="http://hyjal-binbin.com/categories/python/"/>
    
      <category term="爬虫" scheme="http://hyjal-binbin.com/categories/python/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[捕获所有USB设备插入消息]]></title>
    <link href="http://hyjal-binbin.com/2015/10/28/USBMessage/"/>
    <id>http://hyjal-binbin.com/2015/10/28/USBMessage/</id>
    <published>2015-10-27T16:00:00.000Z</published>
    <updated>2015-10-30T08:13:41.189Z</updated>
    <content type="html"><![CDATA[<h1 id="0x00_说明">0x00 说明</h1><p>　　最先在网上copy的代码，能捕获U盘插入的消息，但不能捕获其他USB设备的消息，且无法获取U盘dbcc_name，多次询问度娘后终于找到正确的姿势，通过RegisterDeviceNotification注册DBT_DEVTYP_DEVICEINTERFACE，获取所有USB类设备的通知。</p>
<h1 id="0x01_WM_DEVICECHANGE">0x01 WM_DEVICECHANGE</h1><p>　　查询MSDN<a href="https://msdn.microsoft.com/en-us/library/aa363480(VS.85).aspx" target="_blank" rel="external"><font color="blue">[WM_DEVICECHANGE message]</font></a>,当设备或电脑的硬件配置发生改变时，会给每一个顶层窗口发通知，窗口通过WindowPro接收这个消息。WindowPro中的wParam参数告诉我们是具体是发生了什么事件，即设备或电脑的硬件配置发生了怎样的变化;lParam参数包含了一些设备具体的信息（wParam不同，对应的lParam也有一点的变化）。如果有U盘插入（这里为什么说是U盘而不是USB设备将会在后面进行说明），wParam=DBT_DEVICEARRIVAL,lParam中包含了U盘的盘符信息。<br>　　有了上述信息，我们可自己创建一个顶层窗口来接WM_DEVICECHANGE消息。首先定义一个WindowPro函数，当message参数为WM_DEVICECHANGE，wParam参数为DBT_DEVICEARRIVAL时，即表示有U盘插入。<br><a id="more"></a><br><figure class="highlight hsp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">LRESULT CALLBACK UsbProc(<span class="keyword">HWND</span> <span class="keyword">hwnd</span>, UINT message, <span class="keyword">WPARAM</span> <span class="keyword">wParam</span>, <span class="keyword">LPARAM</span> <span class="keyword">lParam</span>)</div><div class="line">&#123;</div><div class="line">	<span class="keyword">switch</span> (message)  </div><div class="line">	&#123;  	</div><div class="line">	<span class="keyword">case</span> WM_DEVICECHANGE:  </div><div class="line">		<span class="keyword">if</span>(<span class="keyword">wParam</span> == DBT_DEVICEARRIVAL) <span class="comment">//设备激活  </span></div><div class="line">		&#123;  </div><div class="line">			PDEV_BROADCAST_HDR lpdb = (PDEV_BROADCAST_HDR)<span class="keyword">lParam</span><span class="comment">;  </span></div><div class="line">			DEV_BROADCAST_HDR* pHdr = (DEV_BROADCAST_HDR*)<span class="keyword">lParam</span><span class="comment">;</span></div><div class="line">			PDEV_BROADCAST_VOLUME lpdbv = (PDEV_BROADCAST_VOLUME)lpdb<span class="comment">;  </span></div><div class="line">			PDEV_BROADCAST_DEVICEINTERFACE pdinfo = (PDEV_BROADCAST_DEVICEINTERFACE)pHdr<span class="comment">;</span></div><div class="line">			<span class="comment">//pdinfo-&gt;dbcc_name</span></div><div class="line">			TCHAR szMsg[<span class="number">80</span>],Disk<span class="comment">;</span></div><div class="line">			Disk = FirstDriveFromMask(lpdbv -&gt;dbcv_unitmask)<span class="comment">;</span></div><div class="line">			wsprintf (szMsg, L<span class="string">"Drive %c: Media has arrived./n"</span>,Disk)<span class="comment">;  </span></div><div class="line">		&#125;  </div><div class="line">		<span class="keyword">break</span><span class="comment">;  </span></div><div class="line">	<span class="keyword">default</span>:</div><div class="line">		<span class="keyword">return</span> DefWindowProc (<span class="keyword">hwnd</span>, message, <span class="keyword">wParam</span>, <span class="keyword">lParam</span>) <span class="comment">;  </span></div><div class="line">	&#125;  </div><div class="line">	<span class="keyword">return</span> <span class="number">0</span><span class="comment">;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　定义个一个窗口类，将窗口的处理函数定义为UsbProc。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">WNDCLASS     wndclass ;</div><div class="line"></div><div class="line">wndclass.style         = CS_HREDRAW | CS_VREDRAW ;<span class="comment">// 窗口类型</span></div><div class="line">wndclass.lpfnWndProc   = UsbProc ;<span class="comment">//窗口处理函数</span></div><div class="line">wndclass.cbClsExtra    = <span class="number">0</span> ;<span class="comment">//窗口扩展</span></div><div class="line">wndclass.cbWndExtra    = <span class="number">0</span> ;<span class="comment">//窗口实例扩展</span></div><div class="line">wndclass.hInstance     = hModule ;<span class="comment">//实例句柄</span></div><div class="line">wndclass.hIcon         = LoadIcon (<span class="literal">NULL</span>, IDI_APPLICATION) ;<span class="comment">//窗口的最小化图标</span></div><div class="line">wndclass.hCursor       = LoadCursor (<span class="literal">NULL</span>, IDC_ARROW) ;<span class="comment">//窗口鼠标光标</span></div><div class="line">wndclass.hbrBackground = (HBRUSH) GetStockObject (WHITE_BRUSH) ;<span class="comment">//窗口背景色</span></div><div class="line">wndclass.lpszMenuName  = <span class="literal">NULL</span> ;<span class="comment">//窗口菜单</span></div><div class="line">wndclass.lpszClassName = szAppName ;<span class="comment">// 窗口类名</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//创建自定义的窗口类时，在使用该窗口类前必须注册该窗口类</span></div><div class="line"><span class="keyword">if</span> (!RegisterClass (&amp;wndclass))</div><div class="line">&#123;</div><div class="line">	MessageBox (<span class="literal">NULL</span>, TEXT (<span class="string">"This program requires Windows NT!"</span>), </div><div class="line">		szAppName, MB_ICONERROR) ;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span> ;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//创建窗口用来接收消息</span></div><div class="line">hwnd = CreateWindow (szAppName,                  <span class="comment">// window class name</span></div><div class="line">	TEXT (<span class="string">"The Hello Program"</span>), <span class="comment">// window caption</span></div><div class="line">	WS_OVERLAPPEDWINDOW,        <span class="comment">// window style</span></div><div class="line">	CW_USEDEFAULT,              <span class="comment">// initial x position</span></div><div class="line">	CW_USEDEFAULT,              <span class="comment">// initial y position</span></div><div class="line">	CW_USEDEFAULT,              <span class="comment">// initial x size</span></div><div class="line">	CW_USEDEFAULT,              <span class="comment">// initial y size</span></div><div class="line">	<span class="literal">NULL</span>,                       <span class="comment">// parent window handle</span></div><div class="line">	<span class="literal">NULL</span>,                       <span class="comment">// window menu handle</span></div><div class="line">	hModule,                  <span class="comment">// program instance handle</span></div><div class="line">	<span class="literal">NULL</span>);                  <span class="comment">// creation parameters</span></div></pre></td></tr></table></figure></p>
<h1 id="0x03_Register_DBT_DEVTYP_DEVICEINTERFACE">0x03 Register DBT_DEVTYP_DEVICEINTERFACE</h1><p>　　通过上面的代码，能够捕获U盘插入的消息，但却无法捕获到其他类型的USB设备。经过调试，发现只有当pHdr-&gt;dbch_devicetype=DBT_DEVTYP_VOLUME时，才会接收到通知。所以上面的代码中用PDEV_BROADCAST_DEVICEINTERFACE结构去格式化lParam就会得到错误的dbcc_classguid和dbcc_name,而用PDEV_BROADCAST_VOLUME则可以获取正确的盘符信息（dbcv_unitmask）。<br><figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">typedef struct _DEV_BROADCAST_HDR &#123;</div><div class="line">  <span class="type">DWORD</span> dbch_size;</div><div class="line">  <span class="type">DWORD</span> dbch_devicetype;</div><div class="line">  <span class="type">DWORD</span> dbch_reserved;</div><div class="line">&#125; <span class="type">DEV_BROADCAST_HDR</span>, *<span class="type">PDEV_BROADCAST_HDR</span>;</div><div class="line"></div><div class="line">typedef struct _DEV_BROADCAST_VOLUME &#123;</div><div class="line">  <span class="type">DWORD</span> dbcv_size;</div><div class="line">  <span class="type">DWORD</span> dbcv_devicetype;</div><div class="line">  <span class="type">DWORD</span> dbcv_reserved;</div><div class="line">  <span class="type">DWORD</span> dbcv_unitmask;</div><div class="line">  <span class="type">WORD</span>  dbcv_flags;</div><div class="line">&#125; <span class="type">DEV_BROADCAST_VOLUME</span>, *<span class="type">PDEV_BROADCAST_VOLUME</span>;</div><div class="line"></div><div class="line">typedef struct _DEV_BROADCAST_DEVICEINTERFACE &#123;</div><div class="line">  <span class="type">DWORD</span> dbcc_size;</div><div class="line">  <span class="type">DWORD</span> dbcc_devicetype;</div><div class="line">  <span class="type">DWORD</span> dbcc_reserved;</div><div class="line">  <span class="type">GUID</span>  dbcc_classguid;</div><div class="line">  <span class="type">TCHAR</span> dbcc_name[1];</div><div class="line">&#125; <span class="type">DEV_BROADCAST_DEVICEINTERFACE</span>, *<span class="type">PDEV_BROADCAST_DEVICEINTERFACE</span>;</div></pre></td></tr></table></figure></p>
<p>　　MSDN<a href="https://msdn.microsoft.com/EN-US/library/windows/desktop/aa363431.aspx" target="_blank" rel="external"><font color="blue">[RegisterDeviceNotification]</font></a>中Remarks部分说明了顶层窗口会收到basic notification，其中就包括了DBT_DEVTYP_VOLUME和DBT_DEVTYP_PORT，其他类型的通知则需要通过RegisterDeviceNotification来注册。RegisterDeviceNotification中第二个参数填入DEV_BROADCAST_DEVICEINTERFACE结构，dbcc_devicetype = DBT_DEVTYP_DEVICEINTERFACE、dbcc_classguid = GUID_DEVINTERFACE_USB_DEVICE,也可以根据需要换成他<a href="http://blog.csdn.net/jhqin/article/details/6775321" target="_blank" rel="external"><font color="blue">常用设备接口类GUID</font></a>。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">/*</div><div class="line"><span class="meta">#</span><span class="bash">define DBT_DEVTYP_OEM                  0x00000000  // oem-defined device <span class="built_in">type</span></span></div><div class="line"><span class="meta">#</span><span class="bash">define DBT_DEVTYP_DEVNODE              0x00000001  // devnode number</span></div><div class="line"><span class="meta">#</span><span class="bash">define DBT_DEVTYP_VOLUME               0x00000002  // logical volume</span></div><div class="line"><span class="meta">#</span><span class="bash">define DBT_DEVTYP_PORT                 0x00000003  // serial, parallel</span></div><div class="line"><span class="meta">#</span><span class="bash">define DBT_DEVTYP_NET                  0x00000004  // network resource</span></div><div class="line"></div><div class="line"><span class="meta">#</span><span class="bash"><span class="keyword">if</span>(WINVER &gt;= 0x040A)</span></div><div class="line"><span class="meta">#</span><span class="bash">define DBT_DEVTYP_DEVICEINTERFACE      0x00000005  // device interface class</span></div><div class="line"><span class="meta">#</span><span class="bash">define DBT_DEVTYP_HANDLE               0x00000006  // file system handle</span></div><div class="line"></div><div class="line"><span class="meta">#</span><span class="bash"><span class="keyword">if</span>(WINVER &gt;= _WIN32_WINNT_WIN7)</span></div><div class="line"><span class="meta">#</span><span class="bash">define DBT_DEVTYP_DEVINST              0x00000007  // device instance</span></div><div class="line">*/</div><div class="line"></div><div class="line">DEV_BROADCAST_DEVICEINTERFACE NotificationFilter;</div><div class="line"></div><div class="line">ZeroMemory(&amp;NotificationFilter, sizeof(NotificationFilter));</div><div class="line"></div><div class="line">NotificationFilter.dbcc_size = sizeof(NotificationFilter);</div><div class="line">NotificationFilter.dbcc_devicetype = DBT_DEVTYP_DEVICEINTERFACE;</div><div class="line">NotificationFilter.dbcc_reserved = 0;</div><div class="line">NotificationFilter.dbcc_classguid = GUID_DEVINTERFACE_USB_DEVICE;</div><div class="line">HDEVNOTIFY hDevNotify = RegisterDeviceNotification(hwnd, &amp;NotificationFilter, DEVICE_NOTIFY_WINDOW_HANDLE);</div><div class="line">...</div><div class="line">UnregisterDeviceNotification(hDevNotify);</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>　　修改WindowPro函数<br><figure class="highlight xl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">LRESULT CALLBACK UsbProc(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)</div><div class="line">&#123;</div><div class="line">	switch (message)  </div><div class="line">	&#123;  	</div><div class="line">	case WM_DEVICECHANGE:  </div><div class="line">		<span class="keyword">if</span>(wParam == DBT_DEVICEARRIVAL) <span class="comment">//设备激活  </span></div><div class="line">		&#123;  </div><div class="line">			PDEV_BROADCAST_HDR lpdb = (PDEV_BROADCAST_HDR)lParam;</div><div class="line">			<span class="function"><span class="title">if</span> (lpdb-&gt;</span>dbch_devicetype == DBT_DEVTYP_DEVICEINTERFACE) </div><div class="line">			&#123;</div><div class="line">				DEV_BROADCAST_HDR* pHdr = (DEV_BROADCAST_HDR*)lParam;</div><div class="line">				PDEV_BROADCAST_DEVICEINTERFACE pdinfo = (PDEV_BROADCAST_DEVICEINTERFACE)pHdr;</div><div class="line">				<span class="function"><span class="title">printf</span>("GUID:%08X-%04X-%04X-%02X%02X-%02X%02X%02X%02X%02X%02X\n",pdinfo-&gt;</span><span class="function"><span class="title">dbcc_classguid</span>.Data1,pdinfo-&gt;</span><span class="function"><span class="title">dbcc_classguid</span>.Data2,pdinfo-&gt;</span><span class="function"><span class="title">dbcc_classguid</span>.Data3,pdinfo-&gt;</span><span class="function"><span class="title">dbcc_classguid</span>.Data4[0],pdinfo-&gt;</span><span class="function"><span class="title">dbcc_classguid</span>.Data4[1],pdinfo-&gt;</span><span class="function"><span class="title">dbcc_classguid</span>.Data4[2],pdinfo-&gt;</span><span class="function"><span class="title">dbcc_classguid</span>.Data4[3],pdinfo-&gt;</span><span class="function"><span class="title">dbcc_classguid</span>.Data4[4],pdinfo-&gt;</span><span class="function"><span class="title">dbcc_classguid</span>.Data4[5],pdinfo-&gt;</span><span class="function"><span class="title">dbcc_classguid</span>.Data4[6],pdinfo-&gt;</span>dbcc_classguid.Data4[<span class="number">7</span>]);</div><div class="line">				<span class="function"><span class="title">printf</span>("dbcc_name:%s",pdinfo-&gt;</span>dbcc_name);</div><div class="line">			&#125;</div><div class="line">		&#125;  </div><div class="line">		break;  </div><div class="line">	default:</div><div class="line">		return DefWindowProc (hwnd, message, wParam, lParam) ;  </div><div class="line">	&#125;  </div><div class="line">	return <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>参考资料<br><a href="http://bbs.csdn.net/topics/390158016" target="_blank" rel="external"><font color="blue">CSDN-关于u盘识别（OnDeviceChange方式）的几个问题，请教！</font></a><br><a href="http://blog.sina.com.cn/s/blog_9ffb29e101018sug.html" target="_blank" rel="external"><font color="blue">新浪博客-利用服务获取USB设备插拨事件以及获取设备硬件信息</font></a></p>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="0x00_说明">0x00 说明</h1><p>　　最先在网上copy的代码，能捕获U盘插入的消息，但不能捕获其他USB设备的消息，且无法获取U盘dbcc_name，多次询问度娘后终于找到正确的姿势，通过RegisterDeviceNotification注册DBT_DEVTYP_DEVICEINTERFACE，获取所有USB类设备的通知。</p>
<h1 id="0x01_WM_DEVICECHANGE">0x01 WM_DEVICECHANGE</h1><p>　　查询MSDN<a href="https://msdn.microsoft.com/en-us/library/aa363480(VS.85).aspx" target="_blank" rel="external"><font color="blue">[WM_DEVICECHANGE message]</font></a>,当设备或电脑的硬件配置发生改变时，会给每一个顶层窗口发通知，窗口通过WindowPro接收这个消息。WindowPro中的wParam参数告诉我们是具体是发生了什么事件，即设备或电脑的硬件配置发生了怎样的变化;lParam参数包含了一些设备具体的信息（wParam不同，对应的lParam也有一点的变化）。如果有U盘插入（这里为什么说是U盘而不是USB设备将会在后面进行说明），wParam=DBT_DEVICEARRIVAL,lParam中包含了U盘的盘符信息。<br>　　有了上述信息，我们可自己创建一个顶层窗口来接WM_DEVICECHANGE消息。首先定义一个WindowPro函数，当message参数为WM_DEVICECHANGE，wParam参数为DBT_DEVICEARRIVAL时，即表示有U盘插入。<br>]]>
    
    </summary>
    
      <category term="Windows" scheme="http://hyjal-binbin.com/categories/Windows/"/>
    
      <category term="USB" scheme="http://hyjal-binbin.com/categories/Windows/USB/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[利用acrobat SDK提取pdf文档内容]]></title>
    <link href="http://hyjal-binbin.com/2015/10/14/GetpdfContent/"/>
    <id>http://hyjal-binbin.com/2015/10/14/GetpdfContent/</id>
    <published>2015-10-13T16:00:00.000Z</published>
    <updated>2015-10-14T08:16:52.158Z</updated>
    <content type="html"><![CDATA[<h1 id="0x00_背景">0x00 背景</h1><p>　　HackingTeam泄漏事件影响颇大，415.77G的内容大多是邮件内容，分析起来比较麻烦，因而被大多数人忽略。网上有很多邮件分析的文章<a href="http://www.sec-un.org/analysis-on-the-hackingteam-mail-security-threat-intelligence-2.html" target="_blank" rel="external"><font color="blue">HT邮件分析</font></a>,主要是针对邮件关联进行分析，若对邮件内容进行分析则需提取邮件附件中的内容，再针对内容做进一步分析。本文背景其实与上文无关，只是借此提升逼格，下面将介绍如何利用acrobat SDK提取pdf文档内容。</p>
<h1 id="0x01_acrobat导入">0x01 acrobat导入</h1><p>　　只要安装了Adobe Acrobat，就能在其安装目录下找到acrobat.tlb，其中包含了adobe公司提供的接口,可对pdf进行各种操作<a href="http://partners.adobe.com/public/developer/en/acrobat/sdk/pdf/iac/IACOverview.pdf" target="_blank" rel="external"><font color="blue">参考文档</font></a>，使用类向导将其导入。<br>　　提取文本内容需导入CAcroApp、CAcroAVDoc、CAcroAVPageView、CAcroPDPage、CAcroPDTextSelect、CAcroHiliteList。<br><a id="more"></a></p>
<h1 id="0x02_提取文档内容">0x02 提取文档内容</h1><p>　　首先需要”打开”pdf，核心代码如下：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">CAcroApp *pAcrpApp = <span class="keyword">new</span> CAcroApp;</div><div class="line">COleException e;</div><div class="line">pAcrpApp-&gt;CreateDispatch(<span class="string">"AcroExch.App"</span>,&amp;e);</div><div class="line">CAcroAVDoc *pAvdoc = <span class="keyword">new</span> CAcroAVDoc;</div><div class="line">pAvdoc-&gt;CreateDispatch(<span class="string">"AcroExch.AVDoc"</span>,&amp;e);</div><div class="line"><span class="comment">//打开pdf,其中PDFName为全路径</span></div><div class="line"><span class="keyword">if</span> (!pAvdoc-&gt;Open(PDFName,<span class="keyword">NULL</span>))</div><div class="line">&#123;</div><div class="line">	printf(<span class="string">"open pdf failed"</span>);</div><div class="line">	...</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　打开文档后，通过pAvdoc可选择页数(默认为第一页)，创建高亮板(CAcroHiliteList),将选择页数的内容加入高亮板，然后就可以从中提取出该页的内容，核心代码如下：<br><figure class="highlight xl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">CAcroAVPageView pageView;</div><div class="line">CAcroPDPage <span class="built_in">page</span>;</div><div class="line">CAcroPDTextSelect* textSelect = new CAcroPDTextSelect;</div><div class="line">CAcroHiliteList* hilite = new CAcroHiliteList;</div><div class="line">long selectionSize;</div><div class="line"><span class="function"><span class="title">pageView</span>.AttachDispatch(pAvdoc-&gt;</span>GetAVPageView(),TRUE);</div><div class="line">	</div><div class="line"><span class="function"><span class="title">hilite</span>-&gt;</span>CreateDispatch(<span class="string">"AcroExch.HiliteList"</span>);</div><div class="line"><span class="keyword">if</span> (hilite) </div><div class="line">&#123;</div><div class="line">    <span class="comment">//设置为第一页</span></div><div class="line">	pageView.GoTo(<span class="number">0</span>);</div><div class="line">	<span class="comment">/*</span></div><div class="line"><span class="comment">	这里是设置高亮板的大小</span></div><div class="line"><span class="comment">	由于没有找到如何在设置高亮板前获取该页内容长度的方法，所以采用设置成极大的长度</span></div><div class="line"><span class="comment">	如有朋友知道方法，欢迎提出相互学习</span></div><div class="line"><span class="comment">	*/</span></div><div class="line">	<span class="function"><span class="title">hilite</span>-&gt;</span>Add(<span class="number">0</span>,<span class="number">4000</span>);		</div><div class="line">	<span class="built_in">page</span>.AttachDispatch(pageView.GetPage(), TRUE);				</div><div class="line">	<span class="function"><span class="title">textSelect</span>-&gt;</span>A<span class="function"><span class="title">ttachDispatch</span>(<span class="built_in">page</span>.CreateWordHilite(hilite-&gt;</span>m_lpDispatch));</div><div class="line"></div><div class="line">	<span class="function"><span class="title">pAvdoc</span>-&gt;</span>S<span class="function"><span class="title">etTextSelection</span>(textSelect-&gt;</span>m_lpDispatch);</div><div class="line"></div><div class="line">	<span class="function"><span class="title">selectionSize</span> = textSelect-&gt;</span>GetNumText();		</div><div class="line">	<span class="keyword">if</span> (selectionSize &amp;&amp; strText.GetLength() &lt; <span class="number">4000</span>)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">for</span>(int i = <span class="number">0</span>;i &lt; selectionSize;i ++)</div><div class="line">		&#123;</div><div class="line">			<span class="function"><span class="title">strText</span> += textSelect-&gt;</span>GetText(i);</div><div class="line">		&#125;			</div><div class="line">	&#125;				</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　程序效果如下：</p>
<p><div align="center"><br><img src="/img/GetPDFConTent.png" alt="GetPDFConTent" align="center"><br></div><br>　　要完整提取出文档中的全部内容，可通过CAcroPDDoc获取pdf总页数，然后利用pageView.GoTo循环每一页，下面给出的完整工程将不包含此部分代码。<br><a href="http://download.csdn.net/detail/hyjal/9179615" target="_blank" rel="external"><font color="blue">完整工程下载</font></a></p>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="0x00_背景">0x00 背景</h1><p>　　HackingTeam泄漏事件影响颇大，415.77G的内容大多是邮件内容，分析起来比较麻烦，因而被大多数人忽略。网上有很多邮件分析的文章<a href="http://www.sec-un.org/analysis-on-the-hackingteam-mail-security-threat-intelligence-2.html" target="_blank" rel="external"><font color="blue">HT邮件分析</font></a>,主要是针对邮件关联进行分析，若对邮件内容进行分析则需提取邮件附件中的内容，再针对内容做进一步分析。本文背景其实与上文无关，只是借此提升逼格，下面将介绍如何利用acrobat SDK提取pdf文档内容。</p>
<h1 id="0x01_acrobat导入">0x01 acrobat导入</h1><p>　　只要安装了Adobe Acrobat，就能在其安装目录下找到acrobat.tlb，其中包含了adobe公司提供的接口,可对pdf进行各种操作<a href="http://partners.adobe.com/public/developer/en/acrobat/sdk/pdf/iac/IACOverview.pdf" target="_blank" rel="external"><font color="blue">参考文档</font></a>，使用类向导将其导入。<br>　　提取文本内容需导入CAcroApp、CAcroAVDoc、CAcroAVPageView、CAcroPDPage、CAcroPDTextSelect、CAcroHiliteList。<br>]]>
    
    </summary>
    
      <category term="Windows" scheme="http://hyjal-binbin.com/categories/Windows/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[windows平台下获取USB设备“身份证”]]></title>
    <link href="http://hyjal-binbin.com/2015/10/07/device-CA/"/>
    <id>http://hyjal-binbin.com/2015/10/07/device-CA/</id>
    <published>2015-10-06T16:00:00.000Z</published>
    <updated>2015-10-22T03:13:30.149Z</updated>
    <content type="html"><![CDATA[<h1 id="0x00_写在前面">0x00 写在前面</h1><p>　　当我们将U盘插入windows主机时，会提示安装驱动，那么windows是如何判断应该安装哪个版本的驱动的呢？在这里将用到设备的身份信息，包括厂商、型号、序列号等。大概半年前做了一个关于设备检测的小工程，看了很多资料和帖子，将获取设备身份信息的方法在此记录，方便以后使用。</p>
<h1 id="0x01_USB设备有哪些身份信息">0x01 USB设备有哪些身份信息</h1><p>　　根据USB规范中的说明<a href="http://www.usb.org/developers/docs" target="_blank" rel="external"><font color="blue">USB规范官方文档</font></a>，供应商ID(VID)/产品识别码(PID)唯一标识一个设备，VID和PID都是两个字节长，其中，供应商ID（VID）由供应商向USB执行论坛申请，每个供应商的VID是唯一的，PID由供应商自行决定，理论上来说，不同的产品、相同产品的不同型号、相同型号的不同设计的产品最好采用不同的PID，以便区别相同厂家的不同设备。<a id="more"></a><br>　　在windows系统中，我们可以通过设备管理器-&gt;要查看的设备-&gt;属性-&gt;详细信息-&gt;硬件ID来查看VID/PID，如下图</p>
<p><div align="center"><br><img src="/img/hardwareID.png" width="414" height="430" alt="硬件ID" align="center"><br></div></p>
<h1 id="0x02_获取USB设备VID/PID">0x02 获取USB设备VID/PID</h1><p>　　下面将介绍枚举USB设备VID/PID的方法，后面会抽时间写一篇介绍如何通过U盘盘符获取U盘VID、PID的文章。<br>　　首先需要USB设备类GUID，设备管理器-&gt;通用串行总线控制器-&gt;随便选择一个设备-&gt;右键-&gt;属性-&gt;详细信息-&gt;设备类GUID，通用串行总线控制器的设备类GUID{36fc9e60-c465-11cf-8056-444553540000}。构造GUID，用SetupDiGetClassDevs获取设备信息结构的句柄，该结构包含了所有已安装USB设备。再调用SetupDiEnumDeviceInfo枚举设备实例，之后再调用SetupDiGetDeviceRegistryProperty即能获取硬件ID。核心代码如下：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">GUID USBGuid = &#123; <span class="number">0x36fc9e60</span>, <span class="number">0xc465</span>, <span class="number">0x11cf</span>, &#123; <span class="number">0x80</span>, <span class="number">0x56</span>, <span class="number">0x44</span>, <span class="number">0x45</span>, <span class="number">0x53</span>, <span class="number">0x54</span>, <span class="number">0x00</span>, <span class="number">0x00</span>&#125; &#125;<span class="comment">;</span></div><div class="line">HDEVINFO hDevInfo = SetupDiGetClassDevs(&amp;USBGuid, NULL, NULL, <span class="keyword">DIGCF_PRESENT);</span></div><div class="line"><span class="keyword">...</span></div><div class="line"><span class="keyword">for </span>(int Device_Index = <span class="number">0</span><span class="comment">;; Device_Index++)</span></div><div class="line">&#123;</div><div class="line">	...</div><div class="line">    <span class="keyword">BOOL </span><span class="keyword">bResualt </span>= SetupDiEnumDeviceInfo(hDevInfo, Device_Index, &amp;tDevData)<span class="comment">;</span></div><div class="line">    ...</div><div class="line">    <span class="keyword">bResualt </span>= SetupDiGetDeviceRegistryProperty(hDevInfo,</div><div class="line">			&amp;tDevData,</div><div class="line">			SPDRP_HARDWAREID,</div><div class="line">			NULL,</div><div class="line">			NULL,</div><div class="line">			<span class="number">0</span>,</div><div class="line">			&amp;RequiredSize)<span class="comment">;</span></div><div class="line">	if (!<span class="keyword">bResualt)</span></div><div class="line"><span class="keyword">	</span>&#123;</div><div class="line">		if (GetLastError() == ERROR_INSUFFICIENT_BUFFER)</div><div class="line">		&#123;</div><div class="line">			<span class="keyword">BYTE </span>*PropertBuffer = (<span class="keyword">BYTE*)malloc(RequiredSize);</span></div><div class="line"><span class="keyword">	</span>		<span class="keyword">bResualt </span>= SetupDiGetDeviceRegistryProperty(hDevInfo,</div><div class="line">				&amp;tDevData,</div><div class="line">				SPDRP_HARDWAREID,</div><div class="line">				NULL,</div><div class="line">				PropertBuffer,</div><div class="line">				RequiredSize,</div><div class="line">				NULL)<span class="comment">;</span></div><div class="line">			if (<span class="keyword">bResualt)</span></div><div class="line"><span class="keyword">	</span>		&#123;</div><div class="line">				TCHAR *HID = (TCHAR*)PropertBuffer<span class="comment">;</span></div><div class="line">				wprintf(L<span class="string">"%s \n"</span>, HID)<span class="comment">;</span></div><div class="line">    		&#125;</div><div class="line">			else</div><div class="line">			&#123;</div><div class="line">					free(PropertBuffer)<span class="comment">;</span></div><div class="line">					return FALSE<span class="comment">;</span></div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	...</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>程序运行效果</p>
<p><div align="center"><br><img src="/img/enum.jpg" alt="Enum" align="center"><br></div><br><a href="http://download.csdn.net/detail/hyjal/9159365" target="_blank" rel="external"><font color="blue">完整工程下载</font></a></p>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="0x00_写在前面">0x00 写在前面</h1><p>　　当我们将U盘插入windows主机时，会提示安装驱动，那么windows是如何判断应该安装哪个版本的驱动的呢？在这里将用到设备的身份信息，包括厂商、型号、序列号等。大概半年前做了一个关于设备检测的小工程，看了很多资料和帖子，将获取设备身份信息的方法在此记录，方便以后使用。</p>
<h1 id="0x01_USB设备有哪些身份信息">0x01 USB设备有哪些身份信息</h1><p>　　根据USB规范中的说明<a href="http://www.usb.org/developers/docs" target="_blank" rel="external"><font color="blue">USB规范官方文档</font></a>，供应商ID(VID)/产品识别码(PID)唯一标识一个设备，VID和PID都是两个字节长，其中，供应商ID（VID）由供应商向USB执行论坛申请，每个供应商的VID是唯一的，PID由供应商自行决定，理论上来说，不同的产品、相同产品的不同型号、相同型号的不同设计的产品最好采用不同的PID，以便区别相同厂家的不同设备。]]>
    
    </summary>
    
      <category term="Windows" scheme="http://hyjal-binbin.com/categories/Windows/"/>
    
      <category term="USB" scheme="http://hyjal-binbin.com/categories/Windows/USB/"/>
    
  </entry>
  
</feed>